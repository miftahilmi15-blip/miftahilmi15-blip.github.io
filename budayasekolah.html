<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>E-SANTRI | Budaya Sekolah</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root { --primary: #1f6f51; --accent: #eab308; --bg: #f0f4f3; }
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; }
  body { background: var(--bg); padding: 15px; }
  .container { width: 100%; max-width: 450px; margin: auto; }
  header { text-align: center; padding: 20px 0; color: var(--primary); }
  .card { background: white; border-radius: 15px; padding: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 15px; }
  label { font-size: 11px; font-weight: 700; color: #888; text-transform: uppercase; margin-left: 5px; }
  select, .search-box { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin-top: 5px; font-size: 14px; outline: none; background: #fff; }
  
  /* Status Bintang */
  .santri-list { margin-bottom: 150px; }
  .santri-item { background: white; border-radius: 12px; padding: 15px; margin-bottom: 10px; border: 1px solid #eee; }
  .info-santri { margin-bottom: 10px; }
  .star-group { display: flex; gap: 10px; justify-content: center; border-top: 1px solid #f5f5f5; padding-top: 10px; }
  .star-btn { font-size: 28px; color: #ddd; cursor: pointer; transition: 0.2s; background: none; border: none; }
  .star-btn.active { color: var(--accent); }
  .label-status { text-align: center; font-size: 11px; font-weight: 700; margin-top: 5px; color: var(--primary); min-height: 15px; }

  /* Footer */
  .footer { position: fixed; bottom: 0; left: 50%; transform: translateX(-50%); width: 100%; max-width: 450px; background: #fff; padding: 15px; border-radius: 20px 20px 0 0; box-shadow: 0 -10px 20px rgba(0,0,0,0.05); }
  .btn-main { width: 100%; padding: 14px; border-radius: 10px; border: none; font-weight: 700; cursor: pointer; font-size: 14px; background: var(--primary); color: #fff; }
  
  /* Lock Screen */
  #lock-screen { position: fixed; inset: 0; background: white; z-index: 2000; display: none; flex-direction: column; align-items: center; justify-content: center; text-align: center; padding: 30px; }
</style>
</head>
<body>

<div id="lock-screen">
    <span style="font-size: 60px;">üîí</span>
    <h2 style="color: #ef4444; margin-top: 20px;">AKSES TERKUNCI</h2>
    <p id="lock-msg" style="color: #666; margin-top: 10px; font-size: 14px;"></p>
</div>

<div class="container" id="app-content">
  <header><h2>BUDAYA SEKOLAH</h2></header>
  
  <div class="card">
    <label>Pilih Guru Pengampu (Ustadz/ah)</label>
    <select id="pilih-ustadz">
      <option value="">-- Pilih Nama --</option>
      <option value="Riani Rizki Astuti">Ibu Riani Rizki Astuti</option>
      <option value="Ustadz Ahmad">Ustadz Ahmad Fauzi</option>
      <option value="Ustadzah Siti">Ustadzah Siti Aminah</option>
      <option value="Ustadz Yusuf">Ustadz Yusuf Mansur</option>
    </select>

    <label style="margin-top: 15px; display: block;">Aspek Penilaian</label>
    <select id="pilih-aspek">
      <option value="Tertib">üìè Tertib</option>
      <option value="Disiplin">‚è∞ Disiplin</option>
      <option value="Tanggung Jawab">üîë Tanggung Jawab</option>
      <option value="Jujur">üõ°Ô∏è Jujur</option>
      <option value="Ramah">üòä Ramah</option>
    </select>
  </div>

  <div class="card">
    <label>Cari Nama Santri 7B</label>
    <input type="text" id="cari" class="search-box" placeholder="Ketik nama..." onkeyup="filter()">
  </div>

  <div id="list" class="santri-list">
    </div>

  <div class="footer">
    <button class="btn-main" onclick="simpan()">üíæ SIMPAN PENILAIAN</button>
  </div>
</div>

<script>
  // --- KONFIGURASI TANGGAL (Ubah di sini) ---
  const TGL_MULAI = "2026-01-15"; // Format: TAHUN-BULAN-TANGGAL
  const TGL_SELESAI = "2026-01-25";
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxOQ96h0-ZmRv6Nq2SB3567EfzeCZD_1NgH3nsV8L5q8MGMKeSWKN848IJTMp2gvFDCEA/exec";

  // 1. Cek Penguncian Otomatis Saat Halaman Dibuka
  window.onload = function() {
    const hariIni = new Date().toISOString().split('T')[0];
    if (hariIni < TGL_MULAI || hariIni > TGL_SELESAI) {
        document.getElementById('app-content').style.display = 'none';
        document.getElementById('lock-screen').style.display = 'flex';
        document.getElementById('lock-msg').innerText = `Maaf, fitur input Budaya Sekolah hanya dibuka pada tanggal ${TGL_MULAI} sampai ${TGL_SELESAI}.`;
    } else {
        loadDataSiswa(); // Muat data otomatis jika terbuka
    }
  };

  // 2. Simulasi Load Data Siswa (Sesuaikan dengan fetch SCRIPT_URL Anda)
  function loadDataSiswa() {
    const cont = document.getElementById('list');
    cont.innerHTML = '<p style="text-align:center; color:#888;">Memuat data santri 7B...</p>';
    
    // Contoh data statis berdasarkan spreadsheet Anda (Ganti dengan fetch jika sudah siap)
    const dataSantri = [
        {nama: "Adisty Intan Farzana", nipd: "242507001"},
        {nama: "Alya Talitha Athaya", nipd: "242507002"},
        {nama: "Balqis", nipd: "242507003"},
        {nama: "Deajeng Ayu Nawang Wulan", nipd: "242507004"}
    ];

    cont.innerHTML = '';
    dataSantri.forEach(x => {
        const div = document.createElement('div');
        div.className = 'santri-item';
        div.innerHTML = `
            <div class="info-santri">
                <b style="font-size:14px;">${x.nama}</b><br>
                <small style="color:#999;">${x.nipd}</small>
            </div>
            <div class="star-group" data-nipd="${x.nipd}" data-nama="${x.nama}">
                <button class="star-btn" onclick="setStar(this, 1)">‚òÖ</button>
                <button class="star-btn" onclick="setStar(this, 2)">‚òÖ</button>
                <button class="star-btn" onclick="setStar(this, 3)">‚òÖ</button>
                <button class="star-btn" onclick="setStar(this, 4)">‚òÖ</button>
            </div>
            <div class="label-status">Belum Dinilai</div>
        `;
        cont.appendChild(div);
    });
  }

  // 3. Logika Bintang
  function setStar(btn, val) {
    const parent = btn.parentElement;
    const stars = parent.querySelectorAll('.star-btn');
    const label = parent.nextElementSibling;
    const kategori = ["", "KURANG", "CUKUP", "BAIK", "SANGAT BAIK"];
    
    stars.forEach((s, i) => {
        s.classList.toggle('active', i < val);
    });
    
    parent.setAttribute('data-nilai', val);
    label.innerText = kategori[val];
  }

  // 4. Fitur Pencarian
  function filter() {
    const val = document.getElementById('cari').value.toLowerCase();
    document.querySelectorAll('.santri-item').forEach(i => {
      i.style.display = i.innerText.toLowerCase().includes(val) ? 'block' : 'none';
    });
  }

  // 5. Simpan Data
  async function simpan() {
    const ustadz = document.getElementById('pilih-ustadz').value;
    const aspek = document.getElementById('pilih-aspek').value;
    if(!ustadz) return alert("Pilih Nama Guru Pengampu!");

    const results = [];
    document.querySelectorAll('.star-group').forEach(g => {
        const nilai = g.getAttribute('data-nilai');
        if(nilai) {
            results.push({
                ustadz: ustadz,
                aspek: aspek,
                nama: g.getAttribute('data-nama'),
                skor: nilai,
                tanggal: new Date().toLocaleDateString()
            });
        }
    });

    if(results.length === 0) return alert("Berikan penilaian minimal pada satu santri!");

    alert(`Berhasil! ${results.length} data karakter telah tersimpan ke database Ibu ${ustadz}.`);
    // Integrasikan fetch(SCRIPT_URL) di sini untuk kirim ke Google Sheets
  }
</script>
</body>
</html>
