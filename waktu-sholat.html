<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Waktu Sholat & Kiblat</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
  :root{
    --green:#5E915E;
    --green-soft:#E9F5E9;
    --text:#333;
    --gold:#FFD700;
  }
  body{margin:0;font-family:'Poppins',sans-serif;background:#f4f7f4;}
  header{
    text-align:center;
    padding:20px;
    background:var(--green);
    color:white;
  }
  header h1{margin:5px 0;font-size:24px;}
  header p{margin:2px 0;font-size:14px;}
  .hero-card{
    margin:20px auto;
    max-width:400px;
    background:linear-gradient(135deg,#E9F5E9,#fff);
    border-radius:16px;
    padding:20px;
    box-shadow:0 4px 20px rgba(0,0,0,0.1);
    text-align:center;
  }
  .next-prayer{font-size:18px;font-weight:600;color:var(--green);}
  .countdown{margin-top:8px;font-size:16px;color:#555;}
  .quick-btns{display:flex;justify-content:center;gap:20px;margin:20px 0;}
  .quick-btns button{
    background:var(--green);
    color:white;
    border:none;
    padding:12px 18px;
    border-radius:10px;
    font-weight:600;
    cursor:pointer;
  }
  .prayer-list{max-width:400px;margin:0 auto;}
  .prayer-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:12px 16px;
    background:rgba(255,255,255,0.8);
    border-radius:12px;
    margin-bottom:10px;
    box-shadow:0 4px 10px rgba(0,0,0,0.05);
  }
  .compass{
    position:relative;
    margin:30px auto;
    width:250px;
    height:250px;
    border:4px solid var(--gold);
    border-radius:50%;
  }
  .compass img{
    position:absolute;
    width:40px;
    height:40px;
    transform:translate(-50%,-50%);
    top:50%;
    left:50%;
    transition:transform 0.5s linear;
  }
</style>
</head>
<body>

<header>
  <h1 id="clock">--:--:--</h1>
  <p id="date">Memuat tanggal...</p>
  <p id="location">Memuat lokasi...</p>
</header>

<div class="hero-card">
  <div class="next-prayer" id="next-prayer">Sholat berikutnya: --</div>
  <div class="countdown" id="countdown">--:--:--</div>
</div>

<div class="quick-btns">
  <button onclick="alert('Fitur Masjid')">Masjid</button>
  <button onclick="alert('Fitur Kiblat')">Kiblat</button>
</div>

<div class="prayer-list" id="prayer-list">
  <!-- Jadwal Sholat -->
</div>

<div class="compass">
  <img id="kaabah" src="assets/Ka'bah.png" alt="Ka'bah">
</div>

<script>
// JAM & TANGGAL
function updateClock(){
  const now = new Date();
  const h=String(now.getHours()).padStart(2,'0');
  const m=String(now.getMinutes()).padStart(2,'0');
  const s=String(now.getSeconds()).padStart(2,'0');
  document.getElementById('clock').innerText=`${h}:${m}:${s}`;
  document.getElementById('date').innerText=now.toLocaleDateString('id-ID', {weekday:'long', day:'numeric', month:'long', year:'numeric'});
}
setInterval(updateClock,1000);
updateClock();

// GET LOCATION
let userLat=0, userLon=0;
navigator.geolocation.getCurrentPosition(pos=>{
  userLat=pos.coords.latitude;
  userLon=pos.coords.longitude;
  document.getElementById('location').innerText=`Lat: ${userLat.toFixed(2)}, Lon: ${userLon.toFixed(2)}`;
  loadPrayerTimes();
  updateCompass();
});

// SHOLAT TIMES USING API
async function loadPrayerTimes(){
  if(userLat && userLon){
    const today = new Date();
    const dateStr = today.toISOString().split('T')[0];
    const res = await fetch(`https://api.aladhan.com/v1/timings/${dateStr}?latitude=${userLat}&longitude=${userLon}&method=2`);
    const data = await res.json();
    const timings = data.data.timings;
    const list = document.getElementById('prayer-list');
    list.innerHTML='';
    const prayers=['Fajr','Dhuhr','Asr','Maghrib','Isha'];
    prayers.forEach(p=>{
      const div=document.createElement('div');
      div.className='prayer-item';
      div.innerHTML=`<span>${p}</span><span>${timings[p]}</span>`;
      list.appendChild(div);
    });
    startCountdown(timings);
  }
}

// COUNTDOWN
function startCountdown(timings){
  function updateCountdown(){
    const now = new Date();
    let nextTime=null, nextName='';
    const prayers=['Fajr','Dhuhr','Asr','Maghrib','Isha'];
    for(let p of prayers){
      const t=timings[p].split(':');
      const d=new Date();
      d.setHours(parseInt(t[0]),parseInt(t[1]),0);
      if(d>now){nextTime=d; nextName=p; break;}
    }
    if(!nextTime){
      nextTime=new Date();
      nextTime.setDate(nextTime.getDate()+1);
      const t=timings['Fajr'].split(':');
      nextTime.setHours(parseInt(t[0]),parseInt(t[1]),0);
      nextName='Fajr';
    }
    const diff=(nextTime-now)/1000;
    const h=Math.floor(diff/3600);
    const m=Math.floor((diff%3600)/60);
    const s=Math.floor(diff%60);
    document.getElementById('next-prayer').innerText=`Sholat berikutnya: ${nextName}`;
    document.getElementById('countdown').innerText=`${h}j ${m}m ${s}s`;
  }
  setInterval(updateCountdown,1000);
  updateCountdown();
}

// KIBLAT
function updateCompass(){
  const kaabah = document.getElementById('kaabah');
  function moveKaabah(){
    if(userLat && userLon){
      // Koordinat Ka'bah
      const kaabahLat=21.4225;
      const kaabahLon=39.8262;
      const y=(kaabahLat-userLat)*5+125; // scaling ke lingkaran
      const x=(kaabahLon-userLon)*5+125;
      kaabah.style.top=`${y}px`;
      kaabah.style.left=`${x}px`;
    }
  }
  setInterval(moveKaabah,1000);
  moveKaabah();
}
</script>

</body>
</html>
