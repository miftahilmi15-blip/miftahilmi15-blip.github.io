<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalender Interaktif E-Santri</title>
<style>
  body{font-family:"Poppins",sans-serif;background:#f7f9fb;color:#333;margin:0;padding:0;}
  header{background:#2e5e4e;color:#fff;padding:15px;text-align:center;position:sticky;top:0;z-index:100;}
  header h1{margin:0;font-size:24px;}
  .calendar-controls{display:flex;justify-content:space-between;margin-top:10px;}
  .calendar-controls button{padding:6px 12px;border:none;border-radius:6px;background:#2e5e4e;color:#fff;cursor:pointer;}
  main{max-width:900px;margin:20px auto;padding:0 10px;}
  table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.08);}
  th,td{padding:10px;text-align:center;border:1px solid #ddd;vertical-align:top;height:80px;}
  th{background:#2e5e4e;color:#fff;}
  .libur{background:#fdd;}
  .cuti{background:#ffd;}
  .event{margin-top:5px;font-size:12px;background:#2e5e4e;color:#fff;padding:2px 4px;border-radius:4px;display:block;}
</style>
</head>
<body>

<header>
  <h1>Kalender E-Santri</h1>
  <div class="calendar-controls">
    <button id="prevMonth">&lt; Bulan Sebelumnya</button>
    <span id="monthYear"></span>
    <button id="nextMonth">Bulan Berikut &gt;</button>
  </div>
</header>

<main>
  <table id="calendar">
    <thead>
      <tr>
        <th>Minggu</th>
        <th>Senin</th>
        <th>Selasa</th>
        <th>Rabu</th>
        <th>Kamis</th>
        <th>Jumat</th>
        <th>Sabtu</th>
      </tr>
    </thead>
    <tbody id="calendar-body">
      <!-- Tanggal akan muncul di sini -->
    </tbody>
  </table>
</main>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  // =========================
  // FIREBASE
  // =========================
  const firebaseConfig = {
    apiKey: "AIzaSyAQ1A9rtEoEYoriA5Y7oSB84Fd1Xnu6aes",
    authDomain: "e-santri-ed555.firebaseapp.com",
    projectId: "e-santri-ed555",
    storageBucket: "e-santri-ed555.appspot.com",
    messagingSenderId: "588687778472",
    appId: "1:588687778472:web:3000ae9b18f1004ed2189d"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  // =========================
  // VARIABLES
  // =========================
  const calendarBody = document.getElementById('calendar-body');
  const monthYearEl = document.getElementById('monthYear');
  const prevBtn = document.getElementById('prevMonth');
  const nextBtn = document.getElementById('nextMonth');

  let today = new Date();
  let currentMonth = today.getMonth();
  let currentYear = today.getFullYear();

  // =========================
  // CONTOH DATA LIBUR NASIONAL
  // =========================
  const libur = [
    {tanggal:"2025-12-25", nama:"Hari Natal"},
    {tanggal:"2025-12-01", nama:"Hari Sumpah Pemuda"}
  ];

  // =========================
  // RENDER KALENDER
  // =========================
  function renderCalendar(month, year){
    calendarBody.innerHTML = "";
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month+1, 0).getDate();

    monthYearEl.textContent = `${year} - ${month+1}`;

    let date = 1;
    for(let i=0; i<6; i++){
      const row = document.createElement('tr');
      for(let j=0; j<7; j++){
        const cell = document.createElement('td');
        if(i===0 && j<firstDay){
          cell.innerHTML = "";
        } else if(date > daysInMonth){
          cell.innerHTML = "";
        } else {
          const cellDateStr = `${year}-${String(month+1).padStart(2,'0')}-${String(date).padStart(2,'0')}`;
          cell.innerHTML = `<strong>${date}</strong>`;

          // Tambahkan libur
          const lib = libur.find(l=>l.tanggal===cellDateStr);
          if(lib){
            cell.classList.add('libur');
            const div = document.createElement('div');
            div.className="event";
            div.textContent=lib.nama;
            cell.appendChild(div);
          }

          // Ambil kegiatan dari Firebase
          db.collection('kegiatan')
            .where('tanggal','==',cellDateStr)
            .get()
            .then(snapshot=>{
              snapshot.forEach(doc=>{
                const data = doc.data();
                const div = document.createElement('div');
                div.className='event';
                div.textContent = data.nama + " - " + data.deskripsi;
                cell.appendChild(div);
              });
            });

          date++;
        }
        row.appendChild(cell);
      }
      calendarBody.appendChild(row);
    }
  }

  renderCalendar(currentMonth, currentYear);

  prevBtn.onclick = ()=>{
    currentMonth--;
    if(currentMonth<0){currentMonth=11; currentYear--;}
    renderCalendar(currentMonth, currentYear);
  }

  nextBtn.onclick = ()=>{
    currentMonth++;
    if(currentMonth>11){currentMonth=0; currentYear++;}
    renderCalendar(currentMonth, currentYear);
  }
</script>

</body>
</html>
