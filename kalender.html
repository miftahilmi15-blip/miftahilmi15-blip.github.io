<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kalender Interaktif E-Santri</title>
<style>
  body{
    font-family:"Poppins",sans-serif;
    background:#eef3f0;
    color:#333;
    margin:0;
    padding:0;
  }

  header {
    background:#2e5e4e;
    color:#fff;
    padding:15px 20px;
    text-align:center;
    position:sticky;
    top:0;
    z-index:100;
    box-shadow:0 4px 12px rgba(0,0,0,.15);
  }

  header h1 {font-size:26px;margin:0 0 5px;}

  #monthYear {
    font-size:18px;
    font-weight:500;
    color:#fff;
  }

  .calendar-controls {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:10px;
  }

  .calendar-controls button {
    padding:8px 15px;
    border:none;
    border-radius:8px;
    background:#1e4639;
    color:#fff;
    cursor:pointer;
    font-size:14px;
    transition:.2s;
  }

  main {
    max-width:950px;
    margin:20px auto;
    padding:0 10px;
  }

  table {
    width:100%;
    border-collapse:collapse;
    background:#fff;
    border-radius:14px;
    overflow:hidden;
    box-shadow:0 4px 16px rgba(0,0,0,.12);
  }

  th {
    background:#2e5e4e;
    color:#fff;
    padding:12px;
    font-size:14px;
    font-weight:600;
  }

  th:nth-child(1) {
    background:#c53333;
  }

  td {
    border:1px solid #ddd;
    height:90px;
    text-align:center;
    font-size:14px;
    position:relative;
    padding:4px;
  }

  td:hover {
    background:#e9f6f0;
  }

  td strong {
    display:block;
    font-size:16px;
    margin-bottom:4px;
  }

  td:nth-child(1) strong {color:#d11a1a;} /* Minggu */
  td:nth-child(7) strong {color:#245442;} /* Sabtu */

  .libur {background:#ffe1e1 !important;}
  .cuti  {background:#fff4c3 !important;}

  .event {
    font-size:11px;
    background:#155c46;
    color:#fff;
    padding:2px 4px;
    border-radius:6px;
    display:block;
    margin-top:3px;
  }
</style>
</head>
<body>

<header>
  <h1>Kalender E-Santri</h1>
  <div class="calendar-controls">
    <button id="prevMonth">&lt; Bulan Sebelumnya</button>
    <span id="monthYear"></span>
    <button id="nextMonth">Bulan Berikut &gt;</button>
  </div>
</header>

<main>
  <table>
    <thead>
      <tr>
        <th>Minggu</th>
        <th>Senin</th>
        <th>Selasa</th>
        <th>Rabu</th>
        <th>Kamis</th>
        <th>Jumat</th>
        <th>Sabtu</th>
      </tr>
    </thead>
    <tbody id="calendar-body"></tbody>
  </table>
</main>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

<script>
  firebase.initializeApp({
    apiKey:"AIzaSyAQ1A9rtEoEYoriA5Y7oSB84Fd1Xnu6aes",
    authDomain:"e-santri-ed555.firebaseapp.com",
    projectId:"e-santri-ed555",
    storageBucket:"e-santri-ed555.appspot.com",
    messagingSenderId:"588687778472",
    appId:"1:588687778472:web:3000ae9b18f1004ed2189d"
  });
  const db=firebase.firestore();

  const calendarBody=document.getElementById("calendar-body");
  const monthYearEl=document.getElementById("monthYear");

  let today=new Date();
  let currentMonth=today.getMonth();
  let currentYear=today.getFullYear();

  const tanggalKhusus=[
    {tanggal:"2025-01-01",nama:"Tahun Baru",tipe:"libur"},
    {tanggal:"2025-03-31",nama:"Cuti Bersama Idul Fitri",tipe:"cuti"},
    {tanggal:"2025-04-01",nama:"Cuti Bersama Idul Fitri",tipe:"cuti"},
    {tanggal:"2025-04-18",nama:"Idul Fitri",tipe:"libur"},
    {tanggal:"2025-12-25",nama:"Natal",tipe:"libur"}
  ];

  function renderCalendar(month,year){
    calendarBody.innerHTML="";
    let firstDay=new Date(year,month,1).getDay(); 
    // Geser hari agar Minggu tetap kolom pertama
    const daysInMonth=new Date(year,month+1,0).getDate();
    monthYearEl.textContent=new Date(year,month).toLocaleDateString("id-ID",{month:"long",year:"numeric"});

    let date=1;
    for(let i=0;i<6;i++){
      const row=document.createElement("tr");
      for(let j=0;j<7;j++){
        const cell=document.createElement("td");
        
        if(i===0 && j<firstDay){
          cell.innerHTML="";
        } else if(date>daysInMonth){
          cell.innerHTML="";
        } else {
          const d=`${year}-${String(month+1).padStart(2,'0')}-${String(date).padStart(2,'0')}`;
          cell.innerHTML=`<strong>${date}</strong>`;

          const tkh=tanggalKhusus.find(l=>l.tanggal===d);
          if(tkh){
            cell.classList.add(tkh.tipe);
            const div=document.createElement("div");
            div.className="event";
            div.textContent=tkh.nama;
            cell.appendChild(div);
          }

          db.collection("kegiatan").where("tanggal","==",d).get()
          .then(sn=>{sn.forEach(doc=>{
            const ev=doc.data();
            const div=document.createElement("div");
            div.className="event";
            div.textContent=ev.nama;
            cell.appendChild(div);
          })});

          date++;
        }
        row.appendChild(cell);
      }
      calendarBody.appendChild(row);
    }
  }

  renderCalendar(currentMonth,currentYear);

  document.getElementById("prevMonth").onclick=()=>{
    currentMonth--;
    if(currentMonth<0){currentMonth=11;currentYear--;}
    renderCalendar(currentMonth,currentYear);
  };

  document.getElementById("nextMonth").onclick=()=>{
    currentMonth++;
    if(currentMonth>11){currentMonth=0;currentYear++;}
    renderCalendar(currentMonth,currentYear);
  };
</script>

</body>
</html>
