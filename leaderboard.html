<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LIGA</title> 
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1f6f51; --accent: #eab308; --gaming-blue: #1cb0f6; --white: #ffffff; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        
        body { background: var(--primary); color: var(--white); padding: 10px; display: flex; justify-content: center; min-height: 100vh; }
        .wadah-lb { width: 100%; max-width: 450px; }

        /* Bagian Atas Hanya Icon dan Nama Liga */
        .top-hero { text-align: center; padding: 25px 0; }
        .piala { font-size: 60px; display: block; filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3)); }
        .nama-liga { font-size: 35px; font-weight: 900; color: var(--accent); text-transform: uppercase; margin-top: 5px; }

        .filter-section { margin: 20px 0; }
        #filter-bulan { 
            width: 100%; padding: 12px; border-radius: 12px; border: none; 
            background: white; font-weight: 800; color: var(--primary); 
            box-shadow: 0 5px 0 #ddd; outline: none; text-align: center;
        }

        .kartu-lb { 
            background: var(--white); color: #333; border-radius: 15px; 
            padding: 15px; margin-bottom: 10px; display: flex; align-items: center; 
            gap: 12px; box-shadow: 0 4px 0 rgba(0,0,0,0.2); 
        }
        
        .rank-box { font-size: 22px; font-weight: 900; color: #ccc; min-width: 30px; text-align: center; }
        .gold { color: var(--accent); }
        .silver { color: #aaa; }
        .bronze { color: #cd7f32; }

        .ava { width: 45px; height: 45px; background: #eee; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 25px; }
        
        .info { flex: 1; }
        .info h3 { font-size: 14px; font-weight: 800; color: #222; margin-bottom: 2px; }
        .info p { font-size: 11px; color: #777; font-weight: 600; }

        .xp-side { text-align: right; }
        .xp-num { display: block; font-size: 18px; font-weight: 900; color: var(--primary); }
        .xp-txt { font-size: 9px; font-weight: 700; color: #bbb; }

        #loading-state { text-align: center; margin-top: 50px; font-weight: 700; opacity: 0.5; }
    </style>
</head>
<body>

<div class="wadah-lb">
    <div class="top-hero">
        <span class="piala">üèÜ</span>
        <div class="nama-liga">LIGA E-SANTRI</div>
    </div>

    <div class="filter-section">
        <select id="filter-bulan" onchange="muatPeringkat()">
            <option value="1">JANUARI</option>
            <option value="2">FEBRUARI</option>
            <option value="3">MARET</option>
            <option value="4">APRIL</option>
            <option value="5">MEI</option>
            <option value="6">JUNI</option>
            <option value="7">JULI</option>
            <option value="8">AGUSTUS</option>
            <option value="9">SEPTEMBER</option>
            <option value="10">OKTOBER</option>
            <option value="11">NOVEMBER</option>
            <option value="12">DESEMBER</option>
        </select>
    </div>

    <div id="konten-peringkat">
        </div>
</div>

<script>
    const FIREBASE_LB_URL = "https://e-santri-b62be-default-rtdb.asia-southeast1.firebasedatabase.app/leaderboard";
    document.getElementById('filter-bulan').value = new Date().getMonth() + 1;

    async function muatPeringkat() {
        const bln = document.getElementById('filter-bulan').value;
        const blnKey = `2026-${bln}`;
        const container = document.getElementById('konten-peringkat');
        container.innerHTML = '<div id="loading-state">LOADING...</div>';

        try {
            const res = await fetch(`${FIREBASE_LB_URL}/${blnKey}.json`);
            const data = await res.json();
            if (!data) {
                container.innerHTML = '<p style="text-align:center; opacity:0.5; margin-top:30px;">BELUM ADA DATA</p>';
                return;
            }

            let list = Object.values(data).sort((a, b) => b.totalXP - a.totalXP);
            let html = "";

            list.forEach((s, i) => {
                let rankStyle = (i === 0) ? "gold" : (i === 1) ? "silver" : (i === 2) ? "bronze" : "";
                let emoji = (i === 0) ? "ü•á" : (i === 1) ? "ü•à" : (i === 2) ? "ü•â" : "üë§";

                html += `
                <div class="kartu-lb">
                    <div class="rank-box ${rankStyle}">${i + 1}</div>
                    <div class="ava">${emoji}</div>
                    <div class="info">
                        <h3>${s.nama}</h3>
                        <p>KELAS ${s.kelas} ‚Ä¢ ${s.totalSetoran}x SETORAN</p>
                    </div>
                    <div class="xp-side">
                        <span class="xp-num">${s.totalXP}</span>
                        <span class="xp-txt">XP POIN</span>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        } catch (e) {
            container.innerHTML = '<p style="text-align:center;">ERROR</p>';
        }
    }
    muatPeringkat();
</script>

</body>
</html>
