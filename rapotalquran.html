<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>Sistem Rapor Al-Irsyad - Input & Cetak</title>
    <style>
        :root { --hijau-emerald: #1f6f51; }
        body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
        
        /* Gaya Form Input */
        .form-container { 
            max-width: 600px; margin: 0 auto 50px auto; 
            background: white; padding: 25px; 
            border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        h2 { color: var(--hijau-emerald); text-align: center; margin-bottom: 20px; }
        .input-group { margin-bottom: 15px; }
        label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 14px; }
        input, textarea, select { 
            width: 100%; padding: 10px; border: 1px solid #ccc; 
            border-radius: 5px; font-size: 14px; 
        }
        button { 
            width: 100%; padding: 12px; border: none; 
            border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 16px;
            transition: 0.3s; margin-bottom: 10px;
        }
        .btn-simpan { background: var(--hijau-emerald); color: white; }
        .btn-simpan:hover { background: #16533c; }
        .btn-cetak { background: #333; color: white; }

        /* Preview Rapor F4 (Hidden saat input) */
        @media screen { #preview-rapor { display: none; } }
        @media print {
            .form-container { display: none; }
            #preview-rapor { display: block; }
            @page { size: 215mm 330mm; margin: 0; }
            body { background: white; padding: 0; }
        }

        /* Layout Rapor Sama Seperti Sebelumnya */
        .page { width: 215mm; height: 330mm; background: white; padding: 12mm 18mm; margin: 0 auto; color: #000; position: relative; }
        .kop { display: flex; align-items: center; border-bottom: 1px solid #000; padding-bottom: 5px; }
        .kop img { width: 95px; mix-blend-mode: multiply; margin-right: 20px; }
        .kop-text { text-align: center; flex: 1; }
        .kop-text h1 { font-size: 15pt; color: var(--hijau-emerald); font-weight: 900; }
        .kop-text .arab { font-size: 20pt; color: var(--hijau-emerald); font-family: 'Times New Roman'; font-weight: bold; }
        .garis-db { border-bottom: 4px double #000; margin: 2px 0 20px 0; }
        table { width: 100%; border-collapse: collapse; border: 2px solid #000; }
        th, td { border: 1px solid #000; padding: 10px; vertical-align: top; }
        .h-isi { height: 160px; }
    </style>
</head>
<body>

    <div class="form-container">
        <h2>Input Data Rapor Tahfidz</h2>
        <form id="formRapor">
            <div class="input-group">
                <label>Nama Lengkap Santri</label>
                <input type="text" id="nama" placeholder="Masukkan Nama..." required>
            </div>
            <div class="input-group" style="display:flex; gap:10px;">
                <div style="flex:1">
                    <label>NISN</label>
                    <input type="text" id="nisn" placeholder="NISN">
                </div>
                <div style="flex:1">
                    <label>Kelas</label>
                    <input type="text" id="kelas" placeholder="Contoh: 7A" required>
                </div>
            </div>
            <div class="input-group" style="display:flex; gap:10px;">
                <div style="flex:1">
                    <label>Semester</label>
                    <select id="semester"><option>1 (Ganjil)</option><option>2 (Genap)</option></select>
                </div>
                <div style="flex:1">
                    <label>Tahun Pelajaran</label>
                    <input type="text" id="tp" value="2025/2026">
                </div>
            </div>
            <div class="input-group">
                <label>Pencapaian Tahsin</label>
                <textarea id="tahsin" rows="2"></textarea>
            </div>
            <div class="input-group">
                <label>Keterangan Tahsin</label>
                <textarea id="k_tahsin" rows="2"></textarea>
            </div>
            <div class="input-group">
                <label>Pencapaian Tahfizh</label>
                <textarea id="tahfizh" rows="2"></textarea>
            </div>
            <div class="input-group">
                <label>Keterangan Tahfizh</label>
                <textarea id="k_tahfizh" rows="2"></textarea>
            </div>
            
            <button type="button" class="btn-simpan" onclick="simpanKeFirebase()">üöÄ SIMPAN DATA</button>
            <button type="button" class="btn-cetak" onclick="window.print()">üñ®Ô∏è CETAK SEKARANG</button>
        </form>
    </div>

    <div id="preview-rapor">
        <div class="page">
            <div class="kop">
                <img src="logo.png" onerror="this.src='https://upload.wikimedia.org/wikipedia/id/1/10/Logo_Al-Irsyad_Al-Islamiyyah.png'">
                <div class="kop-text">
                    <p>YAYASAN AL-IRSYAD AL-ISLAMIYYAH KOTA CIREBON</p>
                    <p class="arab">ÿßŸÑŸÖÿØÿ±ÿ≥ÿ© ÿßŸÑŸÖÿ™Ÿàÿ≥ÿ∑ÿ© ÿßŸÑÿ•ÿ±ÿ¥ÿßÿØ ÿßŸÑÿ•ÿ≥ŸÑÿßŸÖŸäÿ©</p>
                    <h1>SMP AL-IRSYAD AL-ISLAMIYYAH KOTA CIREBON</h1>
                    <p style="font-size:7pt">Jl. Panjunan No. 27 Cirebon | ‚òè (0231) 234191</p>
                </div>
            </div>
            <div class="garis-db"></div>
            <h3 style="text-align:center; margin-bottom:20px;">LAPORAN HASIL BELAJAR TAHSIN & TAHFIZH</h3>
            
            <div style="display:flex; justify-content:space-between; margin-bottom:15px; font-size:10pt;">
                <div>Nama: <b id="p-nama">...</b><br>NISN: <span id="p-nisn">...</span></div>
                <div style="text-align:right">Kelas: <b id="p-kelas">...</b><br>Semester: <span id="p-smstr">...</span></div>
            </div>

            <table>
                <tr><th width="50">NO</th><th>PENCAPAIAN</th><th>KETERANGAN</th></tr>
                <tr><td align="center">1</td><td><b>Tahsin</b>: <span id="p-tahsin"></span></td><td id="p-ktahsin" class="h-isi"></td></tr>
                <tr><td align="center">2</td><td><b>Tahfizh</b>: <span id="p-tahfizh"></span></td><td id="p-ktahfizh" class="h-isi"></td></tr>
            </table>
        </div>
    </div>

<script>
    const FIREBASE_URL = "https://e-santri-b62be-default-rtdb.asia-southeast1.firebasedatabase.app/data_rapor";

    async function simpanKeFirebase() {
        // Ambil data dari form
        const data = {
            nama: document.getElementById('nama').value,
            nisn: document.getElementById('nisn').value,
            kelas: document.getElementById('kelas').value,
            semester: document.getElementById('semester').value,
            tp: document.getElementById('tp').value,
            tahsin: document.getElementById('tahsin').value,
            k_tahsin: document.getElementById('k_tahsin').value,
            tahfizh: document.getElementById('tahfizh').value,
            k_tahfizh: document.getElementById('k_tahfizh').value
        };

        if(!data.nama || !data.kelas) { alert("Nama dan Kelas wajib diisi, Bos!"); return; }

        try {
            // Kita pakai nama santri sebagai ID folder agar rapi
            const slug = data.nama.replace(/\s+/g, '_').toLowerCase();
            const response = await fetch(`${FIREBASE_URL}/${slug}.json`, {
                method: 'PUT',
                body: JSON.stringify(data)
            });

            if(response.ok) {
                // UPDATE PREVIEW UNTUK PRINT
                document.getElementById('p-nama').innerText = data.nama;
                document.getElementById('p-nisn').innerText = data.nisn;
                document.getElementById('p-kelas').innerText = data.kelas;
                document.getElementById('p-smstr').innerText = data.semester;
                document.getElementById('p-tahsin').innerText = data.tahsin;
                document.getElementById('p-ktahsin').innerText = data.k_tahsin;
                document.getElementById('p-tahfizh').innerText = data.tahfizh;
                document.getElementById('p-ktahfizh').innerText = data.k_tahfizh;

                alert("‚úÖ Alhamdulillah, Data Tersimpan di data_rapor!");
            }
        } catch (e) { alert("‚ùå Gagal Simpan, Cek Koneksi!"); }
    }
</script>
</body>
</html>
