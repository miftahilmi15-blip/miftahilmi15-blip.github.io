<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>E-Santri | Premium Aesthetic v24</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;800&family=Noto+Naskh+Arabic:wght@700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --primary: #1f6f51;
    --soft-green: #e9f5f0;
    --text-dark: #2d3436;
    --shadow: 0 10px 30px rgba(0,0,0,0.05);
  }

  * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Poppins", sans-serif; -webkit-tap-highlight-color: transparent; }
  
  body { 
    background: #f8faf9; 
    color: var(--text-dark); 
    min-height: 100vh; 
    overflow: hidden; 
    position: relative;
  }

  /* --- IKAN KOI REALISTIS (SVG ANIMATED) --- */
  .fish-container {
    position: absolute; width: 80px; height: 40px; z-index: 1;
    transition: all 6s cubic-bezier(0.45, 0.05, 0.55, 0.95); pointer-events: none;
  }
  
  .koi-svg {
    width: 100%; height: 100%;
    filter: drop-shadow(4px 8px 10px rgba(0,0,0,0.1));
    animation: swim-wiggle 0.8s infinite ease-in-out;
  }

  @keyframes swim-wiggle {
    0%, 100% { transform: scaleY(1) rotate(0deg); }
    50% { transform: scaleY(0.9) rotate(2deg); }
  }

  /* --- HEADER MODERN (SAGE GREEN) --- */
  header {
    background: var(--primary);
    height: 180px;
    padding: 50px 25px;
    border-radius: 0 0 40px 40px;
    position: relative;
    z-index: 10;
    color: white;
  }
  .header-content { display: flex; justify-content: space-between; align-items: center; }
  .title-app { font-family: 'Montserrat'; font-size: 24px; letter-spacing: 1px; }
  .menu-trigger { font-size: 28px; cursor: pointer; }

  /* --- CONTAINER UTAMA --- */
  .container { 
    width: 90%; 
    max-width: 400px; 
    margin: -40px auto 0; 
    position: relative; 
    z-index: 20; 
  }

  /* --- CARD AESTHETIC --- */
  .card {
    background: white;
    border-radius: 24px;
    padding: 20px;
    box-shadow: var(--shadow);
    margin-bottom: 20px;
    border: 1px solid rgba(255,255,255,0.8);
  }

  .streak-card { display: flex; align-items: center; justify-content: space-between; }
  .streak-val { color: var(--primary); font-weight: 700; font-size: 22px; }

  /* --- MAHFUZAT TICKER --- */
  .mahfuzat-banner {
    background: var(--soft-green);
    border-radius: 20px;
    padding: 15px;
    overflow: hidden;
    position: relative;
    border-left: 5px solid var(--primary);
  }
  .m-scroll {
    white-space: nowrap;
    display: inline-block;
    animation: moveText 20s linear infinite;
  }
  @keyframes moveText { from { transform: translateX(100%); } to { transform: translateX(-100%); } }

  /* --- MENU GRID 2 KOLOM (SEPERTI GAMBAR) --- */
  .menu-grid { 
    display: grid; 
    grid-template-columns: repeat(2, 1fr); 
    gap: 15px; 
    margin-top: 10px;
  }
  .menu-item {
    background: white;
    padding: 25px 15px;
    border-radius: 24px;
    text-align: center;
    box-shadow: var(--shadow);
    transition: 0.3s;
    border: 1px solid transparent;
  }
  .menu-item:active { transform: scale(0.95); background: var(--soft-green); }
  .menu-item .icon { font-size: 30px; margin-bottom: 10px; display: block; }
  .menu-item span { font-weight: 600; font-size: 13px; color: #444; }

  /* --- SIDEBAR --- */
  .sidebar { 
    position: fixed; top: 0; right: -85%; width: 85%; height: 100%; 
    background: white; transition: 0.5s cubic-bezier(0.7, 0, 0.3, 1); 
    z-index: 1000; padding: 60px 30px; border-radius: 40px 0 0 40px; 
  }
  .sidebar.open { right: 0; box-shadow: -20px 0 60px rgba(0,0,0,0.1); }
  .sidebar a { display: block; padding: 15px 0; color: #333; text-decoration: none; font-weight: 500; font-size: 16px; border-bottom: 1px solid #f0f0f0; }

  .overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.2); backdrop-filter: blur(4px); z-index: 900; }
  .hidden { display: none !important; }

  /* PELET MAKANAN */
  .food {
    position: absolute; width: 10px; height: 10px; background: #e67e22;
    border-radius: 50%; z-index: 5; animation: drop 1s forwards;
  }
  @keyframes drop { to { opacity: 0; transform: scale(0.5); } }
</style>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
</head>
<body onclick="spawnFood(event)">

<div class="overlay" id="overlay"></div>

<header id="app-header" class="hidden">
  <div class="header-content">
    <div class="title-app">E-SANTRI</div>
    <div class="menu-trigger" id="menu-btn">‚ò∞</div>
  </div>
  <p id="welcome-msg" style="margin-top:10px; font-size:14px; opacity:0.9;"></p>
</header>

<main class="container">
  <div id="login-card" class="card" style="margin-top:100px; text-align:center;">
    <h2 style="color:var(--primary); margin-bottom:25px;">Marhaban</h2>
    <button onclick="loginGoogle()" style="width:100%; padding:18px; border-radius:18px; border:none; background:var(--primary); color:white; font-weight:700; cursor:pointer; box-shadow: 0 5px 15px rgba(31,111,81,0.3);">LOGIN DENGAN GOOGLE</button>
  </div>

  <section id="dashboard" class="hidden">
    <div class="card streak-card">
      <div>
        <p style="font-size:11px; color:#999; font-weight:600; margin-bottom:5px;">DAILY STREAK</p>
        <div class="streak-val" id="streak-count">0 Hari</div>
      </div>
      <div style="font-size:35px;">üî•</div>
    </div>

    <div class="mahfuzat-banner">
      <div class="m-scroll">
        <span id="runArab" style="font-family:'Noto Naskh Arabic'; color:var(--primary); font-size:18px; font-weight:700;"></span>
        <span id="runIndo" style="color:var(--text-dark); font-weight:500; margin-left:10px;"></span>
      </div>
    </div>

    <div class="menu-grid">
      <div class="menu-item" onclick="location.href='absensi.html'"><span class="icon">üìç</span><span>Absensi</span></div>
      <div class="menu-item" onclick="location.href='tahfidz.html'"><span class="icon">üèÜ</span><span>Tahfidz</span></div>
      <div class="menu-item" onclick="handleQuran()"><span class="icon">üìñ</span><span>Al-Quran</span></div>
      <div class="menu-item" onclick="location.href='kamus.html'"><span class="icon">üìë</span><span>Kamus</span></div>
      <div class="menu-item" onclick="location.href='perpustakaan.html'"><span class="icon">üìö</span><span>Perpus</span></div>
      <div class="menu-item" onclick="location.href='budayasekolah.html'"><span class="icon">üïå</span><span>Budaya</span></div>
    </div>
  </section>
</main>

<div class="sidebar" id="sidebar">
  <div style="text-align:center; margin-bottom:30px;">
    <img id="user-photo" src="" style="width:80px; height:80px; border-radius:24px; border:4px solid var(--soft-green); margin-bottom:10px;">
    <h3 id="sidebar-name" style="color:var(--primary);">Santri</h3>
  </div>
  <a href="#" onclick="location.reload()">üè† Dashboard</a>
  <a href="#" onclick="location.href='kalender.html'">üìÖ Kalender</a>
  <a href="#" onclick="location.href='sholat.html'">üïå Waktu Sholat</a>
  <a href="#" onclick="logout()" style="color:#eb4d4b; border:none; margin-top:30px;">üö™ Logout Akun</a>
</div>

<script>
  firebase.initializeApp({ apiKey:"AIzaSyAQ1A9rtEoEYoriA5Y7oSB84Fd1Xnu6aes", authDomain:"e-santri-ed555.firebaseapp.com", projectId:"e-santri-ed555" });

  // --- IKAN KOI PREMIUM SVG ---
  const koiSVG = `
    <svg viewBox="0 0 100 50" class="koi-svg">
      <path d="M10,25 Q30,5 65,25 Q30,45 10,25" fill="#f9ca24" />
      <path d="M15,20 Q25,15 35,22 M15,30 Q25,35 35,28" fill="none" stroke="white" stroke-width="1" opacity="0.5"/>
      <path d="M65,25 Q85,10 95,15 L85,25 L95,35 Q85,40 65,25" fill="#f0932b" />
      <circle cx="22" cy="20" r="2.5" fill="white"/><circle cx="22" cy="20" r="1" fill="black"/>
    </svg>`;

  const fishes = [];
  function initFish() {
    for(let i=0; i<4; i++) {
      const f = document.createElement('div');
      f.className = 'fish-container';
      f.innerHTML = koiSVG;
      // Beri warna acak pada badan ikan
      const colors = ['#f0932b', '#eb4d4b', '#ffffff', '#2d3436'];
      f.querySelector('path').style.fill = colors[i];
      
      f.x = Math.random() * 80; f.y = Math.random() * 80;
      f.style.left = f.x + 'vw'; f.style.top = f.y + 'vh';
      document.body.appendChild(f);
      fishes.push({ el: f, x: f.x, y: f.y });
    }
    moveFish();
  }

  function moveFish() {
    fishes.forEach(f => {
      const nx = Math.random() * 90; const ny = Math.random() * 90;
      const angle = Math.atan2(ny - f.y, nx - f.x) * 180 / Math.PI;
      f.el.style.left = nx + 'vw'; f.el.style.top = ny + 'vh';
      f.el.style.transform = `rotate(${angle}deg)`;
      f.x = nx; f.y = ny;
    });
    setTimeout(moveFish, 6000);
  }

  function spawnFood(e) {
    if (document.getElementById('dashboard').classList.contains('hidden')) return;
    const food = document.createElement('div');
    food.className = 'food';
    food.style.left = e.clientX + 'px'; food.style.top = e.clientY + 'px';
    document.body.appendChild(food);
    setTimeout(() => food.remove(), 1000);

    fishes.forEach(f => {
      const tx = e.clientX - 40; const ty = e.clientY - 20;
      const angle = Math.atan2(ty - (f.y * window.innerHeight/100), tx - (f.x * window.innerWidth/100)) * 180 / Math.PI;
      f.el.style.transition = 'all 1.5s ease-out';
      f.el.style.left = tx + 'px'; f.el.style.top = ty + 'px';
      f.el.style.transform = `rotate(${angle}deg)`;
      setTimeout(() => f.el.style.transition = 'all 6s ease-in-out', 2000);
    });
  }

  // --- LOGIKA UTAMA ---
  function handleQuran() {
    const today = new Date().toDateString();
    let s = parseInt(localStorage.getItem('q_streak') || "0");
    if (localStorage.getItem('last_q_date') !== today) {
      s++; localStorage.setItem('q_streak', s); localStorage.setItem('last_q_date', today);
    }
    location.href = 'alquran.html';
  }

  function loginGoogle(){ firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider()); }
  function logout(){ firebase.auth().signOut().then(()=>location.reload()); }

  firebase.auth().onAuthStateChanged(user => {
    if(user){
      document.getElementById("app-header").classList.remove("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
      document.getElementById("login-card").classList.add("hidden");
      document.getElementById("welcome-msg").innerText = "Ahlan, " + user.displayName;
      document.getElementById("sidebar-name").innerText = user.displayName;
      document.getElementById("user-photo").src = user.photoURL;
      document.getElementById('streak-count').innerText = (localStorage.getItem('q_streak') || "0") + " Hari";
      
      const m = [{ar:"ŸÖŸéŸÜŸí ÿ¨ŸéÿØŸéŸë ŸàŸéÿ¨ŸéÿØŸé", id:"Siapa sungguh-sungguh, dapat."}, {ar:"ŸÖŸéŸÜŸí ÿµŸéÿ®Ÿéÿ±Ÿé ÿ∏ŸéŸÅŸêÿ±Ÿé", id:"Siapa sabar, beruntung."}];
      const d = m[new Date().getDate() % m.length];
      document.getElementById('runArab').innerText = d.ar; document.getElementById('runIndo').innerText = " ‚Äî " + d.id;
      initFish();
    }
  });

  const sb=document.getElementById("sidebar"), ov=document.getElementById("overlay");
  document.getElementById("menu-btn").onclick=()=>{ sb.classList.add("open"); ov.style.display="block"; }
  ov.onclick=()=>{ sb.classList.remove("open"); ov.style.display="none"; }
</script>
</body>
</html>
