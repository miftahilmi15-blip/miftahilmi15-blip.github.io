<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>E-Santri</title>

<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif}
  body {
    background: linear-gradient(135deg, #dff6f0, #f0f4f8);
    color: #333;
    padding: 20px;
    min-height: 100vh;
  }
  .container { max-width:460px; margin:auto; position: relative; }
  .container::before {
    content: "";
    position: absolute;
    top:0; left:0; right:0; bottom:0;
    background-image: url('https://www.transparenttextures.com/patterns/asfalt-dark.png');
    opacity: 0.05;
    pointer-events: none;
    border-radius: 14px;
  }

  /* Header */
  .header-box{display:flex;align-items:center;gap:15px;padding:15px 20px;border-bottom:1px solid #ccc}
  .logo-box{width:70px;height:70px;padding:5px;border:2px solid #2e5e4e;border-radius:12px;display:flex;justify-content:center;align-items:center;background:#fff;box-shadow:0 2px 6px rgba(0,0,0,.1)}
  .logo{width:60px;height:60px;object-fit:contain}
  .header-text .title{font-size:24px;font-weight:600;color:#2e5e4e}
  .header-text .tagline{font-size:14px;color:#666;margin-top:4px}

  /* Cards */
  .card {
    background: rgba(255,255,255,0.95);
    border-radius: 14px;
    padding: 20px;
    margin: 18px 0;
    box-shadow: 0 4px 12px rgba(0,0,0,.08);
    border-left:5px solid #2e5e4e;
  }

  /* GRID MENU */
  .menu-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:10px}
  .menu-item{background:#fff;padding:15px;border-radius:14px;text-align:center;cursor:pointer;border:1px solid #e0e0e0;box-shadow:0 3px 12px rgba(0,0,0,.1)}
  .menu-item:hover{transform:translateY(-4px);background:#f1f7f5}
  .menu-icon{width:50px;height:50px;margin-bottom:8px;object-fit:contain}

  /* TOMBOL TITIK 3 */
  .menu-trigger{
    position:fixed;top:18px;right:18px;font-size:28px;
    padding:6px 10px;background:#fff;border-radius:10px;
    box-shadow:0 3px 10px rgba(0,0,0,.15);cursor:pointer;z-index:1100;
    display:none;
  }

  /* SIDEBAR */
  .sidebar{position:fixed;top:0;right:-80%;width:80%;height:100%;background:#fff;transition:.3s;z-index:1200;box-shadow:-2px 0 8px rgba(0,0,0,.2)}
  .sidebar.open{right:0}
  .sidebar-header{text-align:center;padding:20px}
  .close-btn{font-size:28px;cursor:pointer;float:right}
  .avatar{width:80px;height:80px;border-radius:50%}
  .sidebar-menu a{padding:12px 20px;display:block;border-bottom:1px solid #eee;color:#333;text-decoration:none}
  .sidebar-menu a:hover{background:#f5f5f5}

  /* OVERLAY */
  .overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.35);z-index:1100}
  .overlay.show{display:block}

  /* POPUP EDIT */
  #edit-profile-popup{position:fixed;top:0;left:0;width:100%;height:100%;display:none;background:rgba(0,0,0,.5);z-index:2000;justify-content:center;align-items:center}
  #edit-profile-popup.show{display:flex}
  .popup-box{background:#fff;padding:25px;border-radius:15px;width:85%;max-width:350px;box-shadow:0 4px 15px rgba(0,0,0,.3)}

  /* Hidden class */
  .hidden{display:none;}
</style>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
</head>
<body>

<div id="wa-report-popup" style="display:none;">
  <div class="popup-box">
    <h3>Laporan / Pengaduan</h3>
    <textarea id="wa-message" placeholder="Tuliskan pengaduan Anda..."
      style="width:100%;height:100px;padding:10px;border-radius:10px;border:1px solid #ccc;"></textarea>
    <button class="btn primary" onclick="sendReport()">Kirim ke WhatsApp</button>
    <button class="btn secondary" onclick="closeWAReport()">Batal</button>
  </div>
</div>

<!-- elemen lain -->
<header>...</header>
<main>...</main>

</body>
</html>

<!-- TITIK TIGA -->
<div class="menu-trigger" id="menu-btn">&#x22EE;</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <span id="close-btn" class="close-btn">&times;</span>
    <img id="user-photo" src="assets/default-avatar.png" class="avatar" alt="Foto Profil">
    <div class="user-name" id="sidebar-name">Pengguna</div>
    <small id="sidebar-email"></small>
  </div>
  <div class="sidebar-menu">
    <a href="index.html">Dashboard</a>
    <a href="#" onclick="openEdit()">Edit Profil</a>
    <hr>
    <a href="#" onclick="openWAReport()">Pengaduan Santri</a>
    <a href="kalender.html">Kalender</a>
    <hr>
    <a href="#">Tentang</a>
    <a href="#">Kebijakan</a>
    <hr>
    <a href="#" onclick="logout()">Logout</a>
  </div>
</div>

<div class="overlay" id="overlay"></div>

<header class="header-box">
  <div class="logo-box"><img src="logo-assunnah.png" class="logo"></div>
  <div class="header-text">
    <h1 class="title">E-Santri</h1>
    <p class="tagline">Berpegang teguh pada Al-Quran dan Hadist</p>
  </div>
</header>

<main class="container">

<div id="login-card" class="card login">
  <h2>Login / Daftar</h2>

  <input type="email" id="email" placeholder="Email" required>
  <input type="password" id="password" placeholder="Password" required>
  <p id="msg" style="color:red; margin-top:8px;"></p>
  <div class="login-btn-group">
    <button class="btn primary" onclick="login()">Login</button>
    <button class="btn" onclick="register()">
  Daftar Akun Baru
</button>
  </div>
</div>

  <!-- DASHBOARD -->
  <section id="dashboard" class="hidden">
    <div class="menu-grid">
      <div class="menu-item" onclick="goTo('absensi.html')">
        <img src="icons/absensi.png" class="menu-icon"><span>Absensi Santri</span>
      </div>
      <div class="menu-item" onclick="goTo('tahfidz.html')">
        <img src="icons/tahfidz.png" class="menu-icon"><span>Tahfidz</span>
      </div>
      <div class="menu-item" onclick="goTo('alquran.html')">
        <img src="icons/alquran.png" class="menu-icon"><span>Al-Quran</span>
      </div>
      <div class="menu-item" onclick="goTo('sop.html')">
        <img src="icons/sop.png" class="menu-icon"><span>SOP Santri</span>
      </div>
      <div class="menu-item" onclick="goTo('kalender.html')">
        <img src="icons/kalender.png" class="menu-icon"><span>Kaldik Yayasan</span>
      </div>
      <div class="menu-item" onclick="goTo('izin.html')">
        <img src="icons/izin.png" class="menu-icon"><span>Perizinan Santri</span>
      </div>
      <div class="menu-item" onclick="goTo('ibadah.html')">
        <img src="icons/ibadah.png" class="menu-icon"><span>Ibadah</span>
      </div>
    </div>
  </section>

</main>

<footer>
  <small>Â© 2025 E-Santri</small>
</footer>

<!-- POPUP EDIT PROFIL -->
<div id="edit-profile-popup">
  <div class="popup-box">
    <h2>Edit Profil</h2>
    <input type="text" id="edit-name" placeholder="Nama baru">
    <input type="email" id="edit-email" placeholder="Email baru">
    <input type="password" id="edit-pass" placeholder="Password baru">
    <button class="btn primary" onclick="saveProfile()">Simpan</button>
    <button class="btn secondary" onclick="closeEdit()">Batal</button>
  </div>
</div>

<script>
  // --- FIREBASE INIT ---
  firebase.initializeApp({
    apiKey:"AIzaSyAQ1A9rtEoEYoriA5Y7oSB84Fd1Xnu6aes",
    authDomain:"e-santri-ed555.firebaseapp.com",
    projectId:"e-santri-ed555"
  });
  const auth = firebase.auth();

  // --- LOGIN / REGISTER ---
  function login() {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, pass)
      .catch(e => msg(e.message));
  }

  function register() {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    auth.createUserWithEmailAndPassword(email, pass)
      .then(() => msg("Akun berhasil dibuat, silakan login"))
      .catch(e => msg(e.message));
  }

  function msg(t) { document.getElementById("msg").innerHTML = t; }
  function logout() { auth.signOut(); }

  // --- AUTH LISTENER ---
  auth.onAuthStateChanged(user => {
    if(user){
      document.getElementById("login-card").classList.add("hidden");
      document.getElementById("dashboard").classList.remove("hidden");
      document.getElementById("menu-btn").style.display = "block";
      document.getElementById("sidebar-name").innerHTML = user.displayName || "Pengguna";
      document.getElementById("sidebar-email").innerHTML = user.email;
    } else {
      document.getElementById("login-card").classList.remove("hidden");
      document.getElementById("dashboard").classList.add("hidden");
      document.getElementById("menu-btn").style.display = "none";
    }
  });

  function goTo(x){ window.location = x; }

  // --- SIDEBAR ---
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("overlay");
  const menuBtn = document.getElementById("menu-btn");
  const closeBtn = document.getElementById("close-btn");

  menuBtn.onclick = () => { sidebar.classList.add("open"); overlay.classList.add("show"); }
  closeBtn.onclick = () => { sidebar.classList.remove("open"); overlay.classList.remove("show"); }
  overlay.onclick = () => { sidebar.classList.remove("open"); overlay.classList.remove("show"); }

  // --- EDIT PROFIL ---
  function openEdit() { document.getElementById("edit-profile-popup").classList.add("show"); }
  function closeEdit() { document.getElementById("edit-profile-popup").classList.remove("show"); }

  async function saveProfile() {
    const user = auth.currentUser;
    if (!user) return alert("Tidak ada user login");

    const name = document.getElementById("edit-name").value.trim();
    const email = document.getElementById("edit-email").value.trim();
    const pass = document.getElementById("edit-pass").value.trim();

    try {
      if(name) await user.updateProfile({ displayName: name });
      if(email) await user.updateEmail(email);
      if(pass) await user.updatePassword(pass);

      alert("Profil berhasil diperbarui!");
      closeEdit();
      location.reload();
    } catch(e) {
      alert("Gagal update: " + e.message);
    }
  }
 // =========================
// POPUP WHATSAPP REPORT
// =========================
function openWAReport(){
  document.getElementById("wa-report-popup").style.display = "flex";
}

function closeWAReport(){
  document.getElementById("wa-report-popup").style.display = "none";
}

function sendReport(){
  const user = auth.currentUser;
  const pesan = document.getElementById("wa-message").value.trim();

  if(!pesan) return alert("Isi pengaduannya dulu ya!");

  const name = user.displayName || "Santri";
  const email = user.email;
  const adminNumber = "6289661946783"; // Ganti nomor admin WA

  const text = `
Pengaduan Santri:
Nama: ${name}
Email: ${email}

Pesan:
${pesan}
  `;

  const encodedMsg = encodeURIComponent(text);
  const url = `https://wa.me/${adminNumber}?text=${encodedMsg}`;

  window.open(url, "_blank");
  closeWAReport();
}
</script>

</body>
</html>
