<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>E-Santri</title>

<style>
  /* Import Font Modern */
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');

  :root {
    --primary: #1f6f51;
    --bg: #f4f7f6;
    --text: #333;
    --muted: #666;
  }

  * { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins", sans-serif; }

  body {
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    padding: 20px;
  }

  /* Container Utama */
  .container { max-width: 420px; margin: auto; }

  /* Header ala IOU (Center Aligned) */
  .header-box {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 30px 0;
    border: none;
  }

  .logo-box {
    width: 90px;
    height: 90px;
    margin-bottom: 15px;
    background: transparent;
    border: none;
    box-shadow: none;
  }

  .logo { width: 100%; height: 100%; object-fit: contain; }

  .header-text .title {
    font-size: 26px;
    font-weight: 700;
    color: var(--primary);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .header-text .tagline { font-size: 13px; color: var(--muted); margin-top: 5px; }

  /* Login Card (Symmetric & Clean) */
  .card {
    background: #fff;
    border-radius: 12px;
    padding: 30px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.06);
    border: 1px solid #eef2f1;
    margin-bottom: 20px;
  }

  .card.login { border-left: none; text-align: center; }
  .card.login h2 { font-size: 22px; margin-bottom: 20px; color: #444; }

  /* Input Fields */
  input {
    width: 100%;
    padding: 14px 16px;
    margin-bottom: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 15px;
    transition: 0.3s;
  }

  input:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(31, 111, 81, 0.1);
  }

  /* Buttons (Lebar Penuh ala IOU) */
  .login-btn-group {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
  }

  .btn {
    width: 100%;
    padding: 14px;
    border-radius: 8px;
    border: none;
    font-weight: 600;
    font-size: 15px;
    cursor: pointer;
    transition: 0.2s;
  }

  .btn.primary { background: var(--primary); color: #fff; }
  .btn.primary:hover { background: #16503a; }
  
  .btn:not(.primary) { 
    background: #f8f9fa; 
    color: var(--primary); 
    border: 1px solid #eee; 
  }

  /* Grid Menu Dashboard */
  .menu-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
  }

  .menu-item {
    background: #fff;
    padding: 15px 10px;
    border-radius: 12px;
    text-align: center;
    border: 1px solid #f0f0f0;
    box-shadow: 0 4px 10px rgba(0,0,0,0.03);
    transition: 0.2s;
  }

  .menu-item:hover { transform: translateY(-3px); box-shadow: 0 6px 15px rgba(0,0,0,0.08); }
  .menu-icon { width: 45px; height: 45px; margin-bottom: 8px; }
  .menu-item span { display: block; font-size: 11px; font-weight: 600; color: #555; }

  /* Sidebar & Utilities */
  .sidebar { position:fixed; top:0; right:-80%; width:80%; height:100%; background:#fff; transition:.3s; z-index:1200; }
  .sidebar.open { right:0; box-shadow: -10px 0 30px rgba(0,0,0,0.1); }
  .menu-trigger { position:fixed; top:20px; right:20px; padding:8px 12px; background:#fff; border-radius:8px; cursor:pointer; z-index:1100; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
  
  footer { text-align: center; padding: 20px; color: #999; }
  .hidden { display: none; }
</style>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
</head>
<body>

<div id="wa-report-popup" style="display:none;">
  <div class="popup-box">
    <h3>Laporan / Pengaduan</h3>
    <textarea id="wa-message" placeholder="Tuliskan pengaduan Anda..."
      style="width:100%;height:100px;padding:10px;border-radius:10px;border:1px solid #ccc;"></textarea>
    <button class="btn primary" onclick="sendReport()">Kirim ke WhatsApp</button>
    <button class="btn secondary" onclick="closeWAReport()">Batal</button>
  </div>
</div>

<!-- TITIK TIGA -->
<div class="menu-trigger" id="menu-btn">&#x22EE;</div>

<!-- SIDEBAR -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <span id="close-btn" class="close-btn">&times;</span>
    <img id="user-photo" src="assets/default-avatar.png" class="avatar" alt="Foto Profil">
    <div class="user-name" id="sidebar-name">Pengguna</div>
    <small id="sidebar-email"></small>
  </div>
  <div class="sidebar-menu">
    <a href="index.html">Dashboard</a>
    <a href="#" onclick="openEdit()">Edit Profil</a>
    <hr>
    <a href="#" onclick="openWAReport()">Pengaduan Santri</a>
    <a href="kalender.html">Kalender</a>
    <hr>
    <a href="#">Tentang</a>
    <a href="#">Kebijakan</a>
    <hr>
    <a href="#" onclick="logout()">Logout</a>
  </div>
</div>

<div class="overlay" id="overlay"></div>

<header class="header-box">
  <div class="logo-box"><img src="logo-assunnah.png" class="logo"></div>
  <div class="header-text">
    <h1 class="title">E-Santri</h1>
    <p class="tagline">Berpegang teguh pada Al-Quran dan Hadist</p>
  </div>
</header>

<main class="container">

<div id="login-card" class="card login">
  <h2>Login / Daftar</h2>

  <input type="email" id="email" placeholder="Email" required>
  <input type="password" id="password" placeholder="Password" required>
  <p id="msg" style="color:red; margin-top:8px;"></p>
  <div class="login-btn-group">
    <button class="btn primary" onclick="login()">Login</button>
    <button class="btn" onclick="register()">Daftar Akun Baru</button>
    <button class="btn google" onclick="loginWithGoogle()">Login dengan Google</button>
  </div>
</div>

  <!-- DASHBOARD -->
  <section id="dashboard" class="hidden">
    <div class="menu-grid">
      <div class="menu-item" onclick="goTo('absensi.html')">
        <img src="icons/absensi.png" class="menu-icon"><span>Absensi Santri</span>
      </div>
      <div class="menu-item" onclick="goTo('tahfidz.html')">
        <img src="icons/tahfidz.png" class="menu-icon"><span>Tahfidz</span>
      </div>
      <div class="menu-item" onclick="goTo('alquran.html')">
        <img src="icons/alquran.png" class="menu-icon"><span>Al-Quran</span>
      </div>
      <div class="menu-item" onclick="goTo('sop.html')">
        <img src="icons/sop.png" class="menu-icon"><span>SOP Santri</span>
      </div>
      <div class="menu-item" onclick="goTo('kalender.html')">
        <img src="icons/kalender.png" class="menu-icon"><span>Kaldik Yayasan</span>
      </div>
      <div class="menu-item" onclick="goTo('izin.html')">
        <img src="icons/izin.png" class="menu-icon"><span>Perizinan Santri</span>
      </div>
      <div class="menu-item" onclick="goTo('ibadah.html')">
        <img src="icons/ibadah.png" class="menu-icon"><span>Ibadah</span>
      </div>
    </div>
  </section>

</main>

<footer>
  <small>Â© 2025 E-Santri</small>
</footer>

<!-- POPUP EDIT PROFIL -->
<div id="edit-profile-popup">
  <div class="popup-box">
    <h2>Edit Profil</h2>
    <input type="text" id="edit-name" placeholder="Nama baru">
    <input type="email" id="edit-email" placeholder="Email baru">
    <input type="password" id="edit-pass" placeholder="Password baru">
    <button class="btn primary" onclick="saveProfile()">Simpan</button>
    <button class="btn secondary" onclick="closeEdit()">Batal</button>
  </div>
</div>

<script>
  // --- FIREBASE INIT ---
  firebase.initializeApp({
    apiKey:"AIzaSyAQ1A9rtEoEYoriA5Y7oSB84Fd1Xnu6aes",
    authDomain:"e-santri-ed555.firebaseapp.com",
    projectId:"e-santri-ed555"
  });
  const auth = firebase.auth();

  // --- LOGIN / REGISTER ---
  function login() {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    auth.signInWithEmailAndPassword(email, pass)
      .catch(e => msg(e.message));
  }

  function register() {
    const email = document.getElementById("email").value;
    const pass = document.getElementById("password").value;
    auth.createUserWithEmailAndPassword(email, pass)
      .then(() => msg("Akun berhasil dibuat, silakan login"))
      .catch(e => msg(e.message));
  }

  function msg(t) { document.getElementById("msg").innerHTML = t; }
  function logout() { auth.signOut(); }

 
// --- LOGIN GOOGLE ---
function loginWithGoogle() {
  const provider = new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
    .then(result => {
      console.log("Login Google berhasil:", result.user);
      msg("");
    })
    .catch(error => {
      console.error(error);
      msg("Login Google gagal: " + error.message);
    });
}

// --- AUTH LISTENER (update sidebar foto profil) ---
auth.onAuthStateChanged(user => {
  if(user){
    document.getElementById("login-card").classList.add("hidden");
    document.getElementById("dashboard").classList.remove("hidden");
    document.getElementById("menu-btn").style.display = "block";
    document.getElementById("sidebar-name").innerHTML = user.displayName || "Pengguna";
    document.getElementById("sidebar-email").innerHTML = user.email;
    document.getElementById("user-photo").src = user.photoURL || "assets/default-avatar.png";
  } else {
    document.getElementById("login-card").classList.remove("hidden");
    document.getElementById("dashboard").classList.add("hidden");
    document.getElementById("menu-btn").style.display = "none";
    document.getElementById("user-photo").src = "assets/default-avatar.png";
  }
});
  // --- SIDEBAR ---
  const sidebar = document.getElementById("sidebar");
  const overlay = document.getElementById("overlay");
  const menuBtn = document.getElementById("menu-btn");
  const closeBtn = document.getElementById("close-btn");

  menuBtn.onclick = () => { sidebar.classList.add("open"); overlay.classList.add("show"); }
  closeBtn.onclick = () => { sidebar.classList.remove("open"); overlay.classList.remove("show"); }
  overlay.onclick = () => { sidebar.classList.remove("open"); overlay.classList.remove("show"); }

  // --- EDIT PROFIL ---
  function openEdit() { document.getElementById("edit-profile-popup").classList.add("show"); }
  function closeEdit() { document.getElementById("edit-profile-popup").classList.remove("show"); }

  async function saveProfile() {
    const user = auth.currentUser;
    if (!user) return alert("Tidak ada user login");

    const name = document.getElementById("edit-name").value.trim();
    const email = document.getElementById("edit-email").value.trim();
    const pass = document.getElementById("edit-pass").value.trim();

    try {
      if(name) await user.updateProfile({ displayName: name });
      if(email) await user.updateEmail(email);
      if(pass) await user.updatePassword(pass);

      alert("Profil berhasil diperbarui!");
      closeEdit();
      location.reload();
    } catch(e) {
      alert("Gagal update: " + e.message);
    }
  }
 // =========================
// POPUP WHATSAPP REPORT
// =========================
function openWAReport(){
  document.getElementById("wa-report-popup").style.display = "flex";
}

function closeWAReport(){
  document.getElementById("wa-report-popup").style.display = "none";
}

function sendReport(){
  const user = auth.currentUser;
  const pesan = document.getElementById("wa-message").value.trim();

  if(!pesan) return alert("Isi pengaduannya dulu ya!");

  const name = user.displayName || "Santri";
  const email = user.email;
  const adminNumber = "6289661946783"; // Ganti nomor admin WA

  const text = `
Pengaduan Santri:
Nama: ${name}
Email: ${email}

Pesan:
${pesan}
  `;

  const encodedMsg = encodeURIComponent(text);
  const url = `https://wa.me/${adminNumber}?text=${encodedMsg}`;

  window.open(url, "_blank");
  closeWAReport();
}
</script>

</body>
</html>
