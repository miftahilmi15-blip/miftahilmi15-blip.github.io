<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>E-Santri | Full Version</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=Noto+Naskh+Arabic:wght@700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
:root {
  --primary: #1b4d3e;
  --primary-grad: linear-gradient(135deg, #1b4d3e 0%, #3e7c6d 100%);
  --bg: #d4e9e2;
  --koi-red: #bc1a1a;
  --koi-white: #ffffff;
  --koi-black: #1a1a1a;
}
* { margin:0; padding:0; box-sizing:border-box; font-family:"Poppins",sans-serif; }
body { background: var(--bg); min-height:100vh; overflow:hidden; position:relative; }
.hidden { display:none !important; }

/* LOGIN */
#login-screen { position:fixed; inset:0; background:#d4e9e2; display:flex; justify-content:center; align-items:center; z-index:1000; }

/* DASHBOARD */
#pond-base { position:fixed; inset:0; z-index:1; pointer-events:none; background:radial-gradient(circle at center, #427466, #1b4d3e); }
.container { width:92%; max-width:400px; margin:-50px auto 20px; position:relative; z-index:10; pointer-events:auto; }
header { background: var(--primary-grad); height:160px; padding:30px 25px; border-radius:0 0 45px 45px; position:relative; z-index:100; box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.profile-trigger { position:absolute; top:30px; right:25px; width:50px; height:50px; border:3px solid white; border-radius:18px; overflow:hidden; cursor:pointer; z-index:110; }

/* KOI */
.koi-unit { position:absolute; z-index:5; pointer-events:none; transition:all 3s ease-in-out; filter:drop-shadow(10px 15px 6px rgba(0,0,0,0.2)); }
.koi-body-svg { width:80px; height:35px; animation: swimming 3s infinite ease-in-out; }
@keyframes swimming { 0%,100%{transform:rotateY(0deg) skewX(0deg);} 50%{transform:rotateY(15deg) skewX(3deg);} }

/* TOUCH LAYER */
#touch-layer { position:fixed; inset:0; z-index:20; cursor:pointer; }

/* MAHFUZAT */
.mahfuzat-box { background: rgba(27,77,62,0.8); backdrop-filter: blur(10px); border-radius:20px; padding:15px; margin-bottom:20px; overflow:hidden; mask-image: linear-gradient(to right, transparent, black 10%, black 90%, transparent); position:relative; z-index:15; }
.mahfuzat-track { display:flex; white-space:nowrap; animation:marquee 35s linear infinite; }
.mahfuzat-item { display:flex; align-items:center; padding-right:70px; }
.ar-text { font-family: 'Noto Naskh Arabic'; font-size:22px; color:#ffd700; margin-right:15px; }
@keyframes marquee { from{transform:translateX(0);} to{transform:translateX(-50%);} }

/* MENU */
.menu-grid { display:grid; grid-template-columns: repeat(3, 1fr); gap:12px; z-index:15; position:relative; }
.menu-item { background: rgba(255,255,255,0.9); padding:25px 5px; border-radius:25px; text-align:center; box-shadow:0 8px 20px rgba(0,0,0,0.05); cursor:pointer; border:1.5px solid white; position:relative; }
.menu-item:active { transform:scale(0.95); }

/* RIPPLE */
.ripple { position:absolute; width:2px; height:2px; border:2px solid rgba(255,255,255,0.4); border-radius:50%; animation:ripple-ani 0.8s ease-out; pointer-events:none; z-index:6; }
@keyframes ripple-ani { to { transform: scale(50); opacity:0; } }

/* SIDEBAR */
.sidebar { position:fixed; top:0; right:-300px; width:300px; height:100%; background:white; transition:0.5s; z-index:500; padding:40px; border-radius:40px 0 0 40px; }
.sidebar.open { right:0; box-shadow:-20px 0 60px rgba(0,0,0,0.3); }
.overlay { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.4); backdrop-filter:blur(8px); z-index:400; }
</style>
</head>
<body>

<!-- LOGIN -->
<section id="login-screen">
  <div style="max-width:300px;text-align:center;">
    <h2 style="color:var(--primary);margin-bottom:20px;">E-Santri Login</h2>
    <input id="email" type="email" placeholder="Email" style="width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:1px solid #ccc;">
    <input id="password" type="password" placeholder="Password" style="width:100%;padding:10px;margin-bottom:10px;border-radius:8px;border:1px solid #ccc;">
    <button id="login-btn" style="width:100%;padding:10px;background:var(--primary);color:white;border:none;border-radius:8px;cursor:pointer;">Login</button>
    <p id="login-msg" style="color:red;margin-top:10px;font-size:12px;"></p>
    <button id="google-login" style="width:100%;padding:10px;margin-top:10px;background:#4285f4;color:white;border:none;border-radius:8px;cursor:pointer;">Login with Google</button>
  </div>
</section>

<!-- DASHBOARD -->
<header id="app-header" class="hidden">
  <div class="profile-trigger" id="menu-btn"><img id="user-avatar" src=""></div>
  <h1 style="color:white; font-size:22px; font-weight:800; letter-spacing:1px;">E-SANTRI</h1>
  <p id="welcome-msg" style="color:white; opacity:0.8; font-size:12px; font-weight:600;"></p>
</header>
<main class="container">
  <section id="dashboard" class="hidden">
    <div style="background:white; border-radius:25px; padding:20px; margin-bottom:15px; display:flex; justify-content:space-between; align-items:center; z-index:15; position:relative;">
       <div><p style="font-size:10px; color:#aaa; font-weight:700;">DAILY STREAK</p><h2 id="streak-count" style="color:var(--primary)">0 Hari</h2></div>
       <div style="font-size:32px">üî•</div>
    </div>
    <div class="mahfuzat-box"><div class="mahfuzat-track" id="mahfuzat-list"></div></div>
    <div class="menu-grid">
      <div class="menu-item" onclick="goTo('absensi.html')"><span>üåê</span><p>ABSENSI</p></div>
      <div class="menu-item" onclick="goTo('tahfidz.html')"><span>üèÜ</span><p>TAHFIDZ</p></div>
      <div class="menu-item" onclick="handleQuran()"><span>üìñ</span><p>AL-QURAN</p></div>
      <div class="menu-item" onclick="goTo('kamus.html')"><span>üìë</span><p>KAMUS</p></div>
      <div class="menu-item" onclick="goTo('perpus.html')"><span>üìö</span><p>PERPUS</p></div>
      <div class="menu-item" onclick="goTo('budayasekolah.html')"><span>üïå</span><p>BUDAYA SEKOLAH</p></div>
      <div class="menu-item" onclick="goTo('pengaduan.html')"><span>üìù</span><p>PENGADUAN</p></div>
      <div class="menu-item" onclick="goTo('kalender.html')"><span>üìÖ</span><p>KALENDER</p></div>
      <div class="menu-item" onclick="goTo('waktu-sholat.html')"><span>üïã</span><p>WAKTU SHOLAT</p></div>
      <div class="menu-item" onclick="logout()"><span>üö™</span><p>LOGOUT</p></div>
    </div>
  </section>
</main>

<div class="overlay" id="overlay"></div>
<div class="sidebar" id="sidebar">
  <div style="text-align:center; margin-bottom:30px;">
    <img id="sidebar-photo" src="" style="width:90px; height:90px; border-radius:25px; border:4px solid var(--bg); object-fit:cover;">
    <h3 id="sidebar-name" style="margin-top:15px; color:var(--primary); font-weight:800;">Santri</h3>
  </div>
  <a href="#" onclick="location.reload()" style="display:flex;align-items:center;padding:15px;color:#333;text-decoration:none;gap:15px;font-weight:600;"><i class="fa-solid fa-house"></i> Beranda</a>
  <a href="#" onclick="logout()" style="display:flex;align-items:center;padding:15px;color:#d32f2f;text-decoration:none;gap:15px;font-weight:600;margin-top:30px;"><i class="fa-solid fa-power-off"></i> Logout</a>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script>
firebase.initializeApp({ apiKey:"AIzaSyAQ1A9rtEoEYoriA5Y7oSB84Fd1Xnu6aes", authDomain:"e-santri-ed555.firebaseapp.com", projectId:"e-santri-ed555" });
const auth = firebase.auth();
const fishList=[];

// KOI GENERATOR
function createKoiSVG(index){
  const colors=['#bc1a1a','#1a1a1a','#f39c12'];
  const patternColor=colors[index%3];
  const x1=20+Math.random()*30, y1=10+Math.random()*15;
  const x2=50+Math.random()*30, y2=20+Math.random()*15;
  return `<svg class="koi-body-svg" viewBox="0 0 120 45" xmlns="http://www.w3.org/2000/svg">
      <defs><linearGradient id="ginrin${index}" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:white;stop-opacity:0.3"/>
      <stop offset="50%" style="stop-color:white;stop-opacity:0.8"/>
      <stop offset="100%" style="stop-color:white;stop-opacity:0.3"/></linearGradient></defs>
      <ellipse cx="40" cy="22" rx="15" ry="20" fill="rgba(255,255,255,0.3)" stroke="rgba(255,255,255,0.5)" stroke-width="0.5"/>
      <path d="M10,22 C10,5 80,5 110,22 C80,39 10,39 10,22" fill="white"/>
      <ellipse cx="${x1}" cy="${y1}" rx="12" ry="8" fill="${patternColor}"/>
      <ellipse cx="${x2}" cy="${y2}" rx="15" ry="6" fill="${patternColor}"/>
      <path d="M20,22 Q60,10 100,22" fill="none" stroke="url(#ginrin${index})" stroke-width="4" opacity="0.4"/>
      <path d="M110,22 L125,10 Q120,22 125,34 Z" fill="rgba(255,255,255,0.6)"/></svg>`;
}

function initPond(){for(let i=0;i<6;i++){const unit=document.createElement('div');unit.className='koi-unit';unit.innerHTML=createKoiSVG(i);unit.style.left=Math.random()*80+'vw';unit.style.top=Math.random()*80+'vh';document.body.appendChild(unit);fishList.push(unit);} moveFish();}
function moveFish(){setInterval(()=>{fishList.forEach(f=>{const dart=Math.random()>0.6;f.style.transitionDuration=(dart?'1.5s':'5s');const x=Math.random()*80+'vw',y=Math.random()*80+'vh',deg=Math.random()*360;f.style.left=x; f.style.top=y; f.style.transform=`rotate(${deg}deg)`; f.style.filter=`drop-shadow(${dart?'40px 50px':'15px 25px'} 15px rgba(0,0,0,0.2))`;});},3000);}
document.getElementById('touch-layer').onclick=(e)=>{const rip=document.createElement('div');rip.className='ripple';rip.style.left=e.clientX+'px'; rip.style.top=e.clientY+'px';document.body.appendChild(rip); setTimeout(()=>rip.remove(),800); fishList.forEach(f=>{f.style.transitionDuration='1.2s'; f.style.left=(e.clientX-50)+'px'; f.style.top=(e.clientY-20)+'px';});};

// MAHFUZAT
function initMahfuzat(){const track=document.getElementById('mahfuzat-list');const items=[{ar:"ŸÖŸéŸÜŸí ÿ¨ŸéÿØŸéŸë ŸàŸéÿ¨ŸéÿØŸé", id:"Siapa giat, pasti dapat."},{ar:"ŸÖŸéŸÜŸí ÿµŸéÿ®Ÿéÿ±Ÿé ÿ∏ŸéŸÅŸêÿ±Ÿé", id:"Siapa sabar, pasti beruntung."},{ar:"ÿßŸÑÿπŸêŸÑŸíŸÖŸè ÿ®ŸêŸÑŸéÿß ÿπŸéŸÖŸéŸÑŸç ŸÉŸéÿßŸÑÿ¥ŸéŸëÿ¨Ÿéÿ±Ÿê ÿ®ŸêŸÑŸéÿß ÿ´ŸéŸÖŸéÿ±Ÿç", id:"Ilmu tanpa amal bagai pohon tak berbuah."}]; track.innerHTML=[...items,...items].map(d=>`<div class="mahfuzat-item"><span class="ar-text">${d.ar}</span><span class="id-text">${d.id}</span></div>`).join('');}

// NAVIGATION
function goTo(u){window.location.href=u;}
function handleQuran(){window.location.href='alquran.html';}
function logout(){auth.signOut().then(()=>{loginScreen.style.display='flex'; dashboard.classList.add('hidden');});}

// AUTH STATE
const loginScreen=document.getElementById('login-screen');
const dashboard=document.getElementById('dashboard');
document.getElementById('login-btn').onclick=()=>{
  const email=document.getElementById('email').value;
  const pass=document.getElementById('password').value;
  document.getElementById('login-msg').innerText="";
  auth.signInWithEmailAndPassword(email,pass)
    .then(cred=>{ loginScreen.style.display='none'; dashboard.classList.remove('hidden'); initPond(); initMahfuzat(); })
    .catch(err=>{document.getElementById('login-msg').innerText=err.message;});
};
document.getElementById('google-login').onclick=()=>{
  const provider=new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
    .then(cred=>{ loginScreen.style.display='none'; dashboard.classList.remove('hidden'); initPond(); initMahfuzat(); })
    .catch(err=>{document.getElementById('login-msg').innerText=err.message;});
};
auth.onAuthStateChanged(user=>{
  if(user){ loginScreen.style.display='none'; dashboard.classList.remove('hidden'); initPond(); initMahfuzat(); }
  else{ loginScreen.style.display='flex'; dashboard.classList.add('hidden'); }
});

// SIDEBAR
const sb=document.getElementById("sidebar"), ov=document.getElementById("overlay");
document.getElementById("menu-btn").onclick=(e)=>{e.stopPropagation(); sb.classList.add("open"); ov.style.display="block";}
ov.onclick=()=>{sb.classList.remove("open"); ov.style.display="none";}
</script>
</body>
</html>
