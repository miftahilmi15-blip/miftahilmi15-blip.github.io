<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Assunnah</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f4f4f4; }
    .hidden { display: none; }

    /* HEADER */
    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: white;
      padding: 12px 16px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    header img { height: 40px; }
    #menu-btn { font-size: 26px; cursor: pointer; display:none; }

    /* LOGIN CARD */
    #auth-section {
      max-width: 330px;
      margin: 60px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    input {
      width: 100%; padding: 10px; margin-top: 8px;
      border-radius: 6px; border: 1px solid #ccc;
    }
    button {
      width: 100%; padding: 10px; margin-top: 12px;
      background: #008cff; color: white;
      border: none; border-radius: 6px;
      cursor: pointer; font-size: 16px;
    }

    /* DASHBOARD */
    #dashboard {
      padding: 20px;
    }
    .menu-box {
      background: white;
      padding: 15px;
      margin-top: 10px;
      border-radius: 10px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.15);
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
    }

    /* SIDEBAR */
    #sidebar {
      position: fixed;
      top: 0; right: -260px;
      width: 260px; height: 100%;
      background: white;
      box-shadow: -3px 0 6px rgba(0,0,0,0.2);
      padding: 20px;
      transition: 0.3s;
      z-index: 20;
    }
    #sidebar.open { right: 0; }

    #overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      z-index: 15;
    }
    #overlay.show { display: block; }

    /* EDIT PROFIL POPUP */
    #edit-popup {
      position: fixed;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      width: 300px;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      display: none;
      z-index: 30;
    }
    #edit-popup input { margin-bottom: 10px; }

  </style>
</head>
<body>

  <!-- HEADER -->
  <header>
    <img src="logo-assunnah.png" alt="Logo">
    <div id="menu-btn">‚ãÆ</div>
  </header>

  <!-- LOGIN SECTION -->
  <div id="auth-section">
    <h3>Login</h3>
    <input id="email" type="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">

    <button id="btn-login">Login</button>
    <button id="btn-register" style="background:#555;">Register</button>
  </div>

  <!-- DASHBOARD -->
  <div id="app-section" class="hidden">
    <div id="dashboard">
      <h2>Dashboard</h2>

      <div class="menu-box">üìö Data Santri</div>
      <div class="menu-box">üë®‚Äçüè´ Data Pengajar</div>
      <div class="menu-box">üìÖ Jadwal Kelas</div>
      <div class="menu-box">üìä Rekap Nilai</div>
    </div>
  </div>

  <!-- SIDEBAR -->
  <div id="sidebar">
    <h3>Menu</h3>
    <p style="font-size:14px;color:#555;">Login sebagai:</p>
    <p id="user-email" style="font-weight:bold;"></p>

    <button id="btn-edit-profile" style="background:#ffa600;margin-top:20px;">Edit Profil</button>
    <button id="btn-logout" style="background:#ff3b3b;">Logout</button>
    <button id="close-btn" style="background:#777;margin-top:20px;">Tutup</button>
  </div>

  <div id="overlay"></div>

  <!-- POPUP EDIT PROFIL -->
  <div id="edit-popup">
    <h3>Edit Profil</h3>
    <input id="editEmail" type="email" placeholder="Email baru">
    <input id="editPassword" type="password" placeholder="Password baru (opsional)">
    <button id="save-edit">Simpan</button>
    <button id="cancel-edit" style="background:#999;">Batal</button>
  </div>


  <script type="module">
    // Firebase Config
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, signInWithEmailAndPassword,
             createUserWithEmailAndPassword, signOut,
             updateEmail, updatePassword } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "ISI_API_KEY",
      authDomain: "ISI_DOMAIN",
      projectId: "ISI_PROJECT",
      storageBucket: "ISI_BUCKET",
      messagingSenderId: "ISI_SENDER",
      appId: "ISI_APPID"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();

    // DOM
    const authSection = document.getElementById("auth-section");
    const appSection  = document.getElementById("app-section");
    const userEmailSpan = document.getElementById("user-email");

    const menuBtn = document.getElementById("menu-btn");
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const closeBtn = document.getElementById("close-btn");

    const btnLogin = document.getElementById("btn-login");
    const btnRegister = document.getElementById("btn-register");
    const btnLogout = document.getElementById("btn-logout");
    const btnEdit = document.getElementById("btn-edit-profile");

    const popup = document.getElementById("edit-popup");
    const editEmail = document.getElementById("editEmail");
    const editPassword = document.getElementById("editPassword");
    const saveEdit = document.getElementById("save-edit");
    const cancelEdit = document.getElementById("cancel-edit");

    // Sidebar control
    menuBtn.onclick = () => {
      sidebar.classList.add("open");
      overlay.classList.add("show");
    };
    closeBtn.onclick = overlay.onclick = () => {
      sidebar.classList.remove("open");
      overlay.classList.remove("show");
    };

    // Auth state
    onAuthStateChanged(auth, user => {
      if (user) {
        authSection.classList.add("hidden");
        appSection.classList.remove("hidden");

        userEmailSpan.textContent = user.email;

        // tampilkan titik tiga
        menuBtn.style.display = "block";

      } else {
        authSection.classList.remove("hidden");
        appSection.classList.add("hidden");

        menuBtn.style.display = "none";
      }
    });

    // Register
    btnRegister.onclick = async () => {
      try {
        await createUserWithEmailAndPassword(auth, email.value, password.value);
        alert("Registrasi berhasil!");
      } catch (e) { alert(e.message); }
    };

    // Login
    btnLogin.onclick = async () => {
      try {
        await signInWithEmailAndPassword(auth, email.value, password.value);
      } catch (e) { alert(e.message); }
    };

    // Logout
    btnLogout.onclick = () => signOut(auth);

    // Edit Profil open
    btnEdit.onclick = () => {
      popup.style.display = "block";
      editEmail.value = auth.currentUser.email;
    };

    cancelEdit.onclick = () => popup.style.display = "none";

    // Save Edit
    saveEdit.onclick = async () => {
      const user = auth.currentUser;

      try {
        if (editEmail.value.trim() !== "")
          await updateEmail(user, editEmail.value.trim());

        if (editPassword.value.trim() !== "")
          await updatePassword(user, editPassword.value.trim());

        alert("Profil berhasil diperbarui!");
        popup.style.display = "none";

      } catch (e) {
        alert("Gagal: " + e.message);
      }
    };

  </script>

</body>
</html>
