<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>E-Santri | Full Version</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@800&family=Noto+Naskh+Arabic:wght@700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
:root {
  --primary: #1b4d3e;
  /* Gradient dibuat lebih cerah agar tidak monoton hijau pekat */
  --primary-grad: linear-gradient(135deg, #1b4d3e 0%, #2a5d4d 100%);
  --bg: #e0f2f1; /* Hijau air yang lebih bening/cerah */
  --koi-red: #d32f2f;
  --koi-orange: #ff9800;
  --koi-black: #212121;
}

/* Perbaikan Agar Menu Bisa Diklik (Z-Index Hierarchy) */
#pond-base { position: fixed; inset: 0; z-index: 1; background: radial-gradient(circle at center, #80cbc4, #4db6ac); }
#touch-layer { position: fixed; inset: 0; z-index: 2; cursor: pointer; } /* Di atas background */

/* Container Menu harus di atas Touch Layer agar bisa diklik */
.container { position: relative; z-index: 100; pointer-events: auto; margin-top: -40px; }
header { position: relative; z-index: 100; background: var(--primary-grad); border-radius: 0 0 40px 40px; padding: 30px 20px 60px; }

/* Anatomi Ikan Tapered */
.koi-unit { 
  position: absolute; 
  z-index: 5; 
  pointer-events: none; 
  transition: all 4s cubic-bezier(0.4, 0, 0.2, 1);
  filter: drop-shadow(15px 25px 8px rgba(0,0,0,0.15));
}

.koi-body-svg { 
  width: 90px; height: 40px; 
  animation: swimming 3s infinite ease-in-out; 
}

@keyframes swimming { 
  0%, 100% { transform: scaleX(1) rotate(0deg); }
  50% { transform: scaleX(0.95) rotate(2deg); }
}

/* Styling Menu agar lebih clean */
.menu-item { 
  background: rgba(255,255,255,0.95); 
  backdrop-filter: blur(10px);
  border: none;
  box-shadow: 0 10px 20px rgba(0,0,0,0.08);
}
.menu-item p { font-size: 9px; letter-spacing: 0.5px; margin-top: 8px; font-weight: 700; }
</style>

<script>
// Fungsi Membuat Ikan dengan Anatomi Torpedo/Tapered
function createKoiSVG(index){
  const colors = [var(--koi-red), var(--koi-black), var(--koi-orange)];
  const pattern = colors[index % 3];
  
  return `<svg class="koi-body-svg" viewBox="0 0 120 45" xmlns="http://www.w3.org/2000/svg">
    <path d="M30,10 Q10,5 25,18" fill="rgba(255,255,255,0.5)" />
    <path d="M30,35 Q10,40 25,27" fill="rgba(255,255,255,0.5)" />
    
    <path d="M10,22.5 C10,10 40,5 70,15 C90,22.5 110,22.5 110,22.5 C110,22.5 90,22.5 70,30 C40,40 10,35 10,22.5" fill="white" />
    
    <ellipse cx="35" cy="18" rx="12" ry="7" fill="${pattern}" opacity="0.9"/>
    <ellipse cx="70" cy="22" rx="15" ry="5" fill="${pattern}" opacity="0.8"/>
    
    <rect x="40" y="21" width="30" height="3" rx="1.5" fill="rgba(255,255,255,0.4)" />
    
    <path d="M110,22.5 L125,10 Q118,22.5 125,35 Z" fill="rgba(255,255,255,0.7)" />
  </svg>`;
}

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
<script>
firebase.initializeApp({ apiKey:"AIzaSyAQ1A9rtEoEYoriA5Y7oSB84Fd1Xnu6aes", authDomain:"e-santri-ed555.firebaseapp.com", projectId:"e-santri-ed555" });
const auth = firebase.auth();
const fishList=[];

// KOI GENERATOR
function createKoiSVG(index){
  const colors=['#bc1a1a','#1a1a1a','#f39c12'];
  const patternColor=colors[index%3];
  const x1=20+Math.random()*30, y1=10+Math.random()*15;
  const x2=50+Math.random()*30, y2=20+Math.random()*15;
  return `<svg class="koi-body-svg" viewBox="0 0 120 45" xmlns="http://www.w3.org/2000/svg">
      <defs><linearGradient id="ginrin${index}" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:white;stop-opacity:0.3"/>
      <stop offset="50%" style="stop-color:white;stop-opacity:0.8"/>
      <stop offset="100%" style="stop-color:white;stop-opacity:0.3"/></linearGradient></defs>
      <ellipse cx="40" cy="22" rx="15" ry="20" fill="rgba(255,255,255,0.3)" stroke="rgba(255,255,255,0.5)" stroke-width="0.5"/>
      <path d="M10,22 C10,5 80,5 110,22 C80,39 10,39 10,22" fill="white"/>
      <ellipse cx="${x1}" cy="${y1}" rx="12" ry="8" fill="${patternColor}"/>
      <ellipse cx="${x2}" cy="${y2}" rx="15" ry="6" fill="${patternColor}"/>
      <path d="M20,22 Q60,10 100,22" fill="none" stroke="url(#ginrin${index})" stroke-width="4" opacity="0.4"/>
      <path d="M110,22 L125,10 Q120,22 125,34 Z" fill="rgba(255,255,255,0.6)"/></svg>`;
}

function initPond(){for(let i=0;i<6;i++){const unit=document.createElement('div');unit.className='koi-unit';unit.innerHTML=createKoiSVG(i);unit.style.left=Math.random()*80+'vw';unit.style.top=Math.random()*80+'vh';document.body.appendChild(unit);fishList.push(unit);} moveFish();}
function moveFish(){setInterval(()=>{fishList.forEach(f=>{const dart=Math.random()>0.6;f.style.transitionDuration=(dart?'1.5s':'5s');const x=Math.random()*80+'vw',y=Math.random()*80+'vh',deg=Math.random()*360;f.style.left=x; f.style.top=y; f.style.transform=`rotate(${deg}deg)`; f.style.filter=`drop-shadow(${dart?'40px 50px':'15px 25px'} 15px rgba(0,0,0,0.2))`;});},3000);}
document.getElementById('touch-layer').onclick=(e)=>{const rip=document.createElement('div');rip.className='ripple';rip.style.left=e.clientX+'px'; rip.style.top=e.clientY+'px';document.body.appendChild(rip); setTimeout(()=>rip.remove(),800); fishList.forEach(f=>{f.style.transitionDuration='1.2s'; f.style.left=(e.clientX-50)+'px'; f.style.top=(e.clientY-20)+'px';});};

// MAHFUZAT
function initMahfuzat(){const track=document.getElementById('mahfuzat-list');const items=[{ar:"مَنْ جَدَّ وَجَدَ", id:"Siapa giat, pasti dapat."},{ar:"مَنْ صَبَرَ ظَفِرَ", id:"Siapa sabar, pasti beruntung."},{ar:"العِلْمُ بِلَا عَمَلٍ كَالشَّجَرِ بِلَا ثَمَرٍ", id:"Ilmu tanpa amal bagai pohon tak berbuah."}]; track.innerHTML=[...items,...items].map(d=>`<div class="mahfuzat-item"><span class="ar-text">${d.ar}</span><span class="id-text">${d.id}</span></div>`).join('');}

// NAVIGATION
function goTo(u){window.location.href=u;}
function handleQuran(){window.location.href='alquran.html';}
function logout(){auth.signOut().then(()=>{loginScreen.style.display='flex'; dashboard.classList.add('hidden');});}

// AUTH STATE
const loginScreen=document.getElementById('login-screen');
const dashboard=document.getElementById('dashboard');
document.getElementById('login-btn').onclick=()=>{
  const email=document.getElementById('email').value;
  const pass=document.getElementById('password').value;
  document.getElementById('login-msg').innerText="";
  auth.signInWithEmailAndPassword(email,pass)
    .then(cred=>{ loginScreen.style.display='none'; dashboard.classList.remove('hidden'); initPond(); initMahfuzat(); })
    .catch(err=>{document.getElementById('login-msg').innerText=err.message;});
};
document.getElementById('google-login').onclick=()=>{
  const provider=new firebase.auth.GoogleAuthProvider();
  auth.signInWithPopup(provider)
    .then(cred=>{ loginScreen.style.display='none'; dashboard.classList.remove('hidden'); initPond(); initMahfuzat(); })
    .catch(err=>{document.getElementById('login-msg').innerText=err.message;});
};
auth.onAuthStateChanged(user=>{
  if(user){ loginScreen.style.display='none'; dashboard.classList.remove('hidden'); initPond(); initMahfuzat(); }
  else{ loginScreen.style.display='flex'; dashboard.classList.add('hidden'); }
});

// SIDEBAR
const sb=document.getElementById("sidebar"), ov=document.getElementById("overlay");
document.getElementById("menu-btn").onclick=(e)=>{e.stopPropagation(); sb.classList.add("open"); ov.style.display="block";}
ov.onclick=()=>{sb.classList.remove("open"); ov.style.display="none";}
</script>
</body>
</html>
